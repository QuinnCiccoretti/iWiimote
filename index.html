<!DOCTYPE HTML>

<html>
   <head>
      <style>
			body { margin: 0; }
			canvas { display: block; }

         .garden {
         position: relative;
         width : 200px;
         height: 200px;
         border: 5px solid #CCC;
         border-radius: 10px;
         }

         .ball {
         position: absolute;
         top   : 90px;
         left  : 90px;
         width : 20px;
         height: 20px;
         background: green;
         border-radius: 100%;
         }
		</style>
      
      <!-- Websocket Test -->
      <script type = "text/javascript">
         function WebSocketTest() { 
            if ("WebSocket" in window) {
               alert("WebSocket is supported by your Browser!");
               
               // Let us open a web socket
               // var ws = new WebSocket("ws://localhost:8080");
               let finalDigits = document.getElementById("lastDigits").value;
               var ws = new WebSocket("ws://192.168."+ finalDigits +":8080");
               
               ws.onopen = function() {
                  
                  // Web Socket is connected, send data using send()
                  for(var i = 0; i< 100; i++){
                  	ws.send("I am javascript #"+i);
                  }
                  
                  // alert("Message is sent...");
               };
				
               ws.onmessage = function (evt) { 
                  var received_msg = evt.data;
                  // alert("Message is received...");
               };
				
               ws.onclose = function() { 
                  
                  // websocket is closed.
                  alert("Connection is closed..."); 
               };
            } else {
              
               // The browser doesn't support WebSocket
               alert("WebSocket NOT supported by your Browser!");
            }
         }
      </script>
		
   </head>
   
   <body>
      <!-- HTML  -->
      <div id = "sse">
         <a href = "javascript:WebSocketTest()">Run WebSocket</a>
         <a href = "javascript:onClick()">Give Permissions</a>
      </div>
      <div class="garden">
         <div class="ball"></div>
      </div>

      <input id="lastDigits" type="text" name="lastDigits"/>
      
      <pre class="output"></pre>
      <!-- Orientation Test -->
      <script>
         var ball   = document.querySelector('.ball');
         var garden = document.querySelector('.garden');
         var output = document.querySelector('.output');

         var maxX = garden.clientWidth  - ball.clientWidth;
         var maxY = garden.clientHeight - ball.clientHeight;

         function handleOrientation(event) {
         var x = event.beta;  // In degree in the range [-180,180]
         var y = event.gamma; // In degree in the range [-90,90]

         output.innerHTML  = "beta : " + x + "\n";
         output.innerHTML += "gamma: " + y + "\n";

         // Because we don't want to have the device upside down
         // We constrain the x value to the range [-90,90]
         if (x >  90) { x =  90};
         if (x < -90) { x = -90};

         // To make computation easier we shift the range of 
         // x and y to [0,180]
         x += 90;
         y += 90;

         // 10 is half the size of the ball
         // It center the positioning point to the center of the ball
         ball.style.top  = (maxY*y/180 - 10) + "px";
         ball.style.left = (maxX*x/180 - 10) + "px";
         }

         window.addEventListener('deviceorientation', handleOrientation, true);
      </script>

      <!-- Give Permissions -->
      <script>
      function onClick() {
         // feature detect
         if (typeof DeviceOrientationEvent.requestPermission === 'function') {
            DeviceOrientationEvent.requestPermission()
            .then(permissionState => {
               if (permissionState === 'granted') {
                  window.addEventListener('deviceorientation', handleOrientation);
               }
            })
            .catch(console.error);
         } else {
            // handle regular non iOS 13+ devices
            window.addEventListener('deviceorientation', handleOrientation);
         }
      }
      </script>
      
   </body>
</html>